@model IEnumerable<movie_hospital_1.dataModel.Movie>
@{
    ViewData["Title"] = "Movies List";
}

<div class="container mt-4">

    <h2 class="mb-4 text-center text-neon">🎬 Movies List</h2>

    <form method="get" asp-action="Index" class="row g-2 align-items-center mb-5 p-3 filter-box">

        <div class="col-md-4">
            <input type="text" name="search" class="form-control"
                   placeholder="Search by movie title..."
                   value="@ViewBag.Search" />
        </div>

        <div class="col-md-3">
            <select name="categoryId" class="form-select filter-select">
                <option value="">-- All Categories --</option>
                @if (ViewBag.Categories != null)
                {
                    foreach (var category in ViewBag.Categories)
                    {
                        <option value="@category.Id"
                                selected="@(ViewBag.CategoryId != null && ViewBag.CategoryId == category.Id)">
                            @category.Name
                        </option>
                    }
                }
            </select>
        </div>

        <div class="col-md-3">
            <select name="year" class="form-select filter-select">
                <option value="">-- All Years --</option>
                @{
                    int currentYear = DateTime.Now.Year;
                    for (int y = currentYear; y >= currentYear - 20; y--)
                    {
                        <option value="@y" selected="@(ViewBag.Year != null && ViewBag.Year == y)">@y</option>
                    }
                }
            </select>
        </div>


        <div class="col-md-2 text-end">
            <button type="submit" class="btn btn-primary w-100 btn-filter-neon">
                <i class="bi bi-funnel"></i> Filter
            </button>
        </div>
    </form>

    <div class="row">
        @if (Model.Any())
        {
            foreach (var movie in Model)
            {
                <div class="col-md-4 mb-4">
                    <div class="card shadow-lg border-0 position-relative h-100">
                        <img src="@movie.ImageURL" class="card-img-top" alt="@movie.Title" style="height: 350px; object-fit: cover;">

                        <span class="badge bg-primary position-absolute top-0 end-0 m-2">
                            @movie.Category?.Name
                        </span>

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">@movie.Title</h5>
                            <div class="card-text-box">
                                <p class="card-text text-muted">@movie.Description</p>
                            </div>

                            <p class="mb-1"><strong>Price:</strong> $@movie.Price</p>
                            <p class="mb-1"><strong>Cinema:</strong> @movie.Cinema?.Name</p>

                            <p class="mb-3">
                                <strong>Actors:</strong>
                                @if (movie.MovieActors != null && movie.MovieActors.Any())
                                {
                                    @string.Join(", ", movie.MovieActors.Select(m => m.Actor?.Name))
                                }
                                else
                                {
                                    <span class="text-muted">No actors</span>
                                }
                            </p>

                         
                            <div class="d-flex mt-auto pt-3 gap-2">

                                <a asp-controller="Home" asp-action="Details" asp-route-id="@movie.Id"
                                   class="btn btn-info flex-grow-1">
                                    Details
                                </a>

                                @if (movie.InCinema)
                                {
                                    <a asp-controller="Orders" asp-action="Book" asp-route-movieId="@movie.Id"
                                       class="btn btn-success btn-book-neon flex-grow-1">
                                        <i class="bi bi-ticket-fill"></i> Book Now
                                    </a>
                                }
                                else
                                {
                                    <button class="btn btn-secondary flex-grow-1" disabled>
                                        Sold Out
                                    </button>
                                }
                            </div>
                 

                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-12">
                <div class="alert alert-warning text-center alert-neon-warning">
                    No movies found with the selected filters.
                </div>
            </div>
        }
    </div>

    @{
        int pageNumber = ViewBag.PageNumber ?? 1;
        int totalPages = ViewBag.TotalPages ?? 1;
        string currentSearch = ViewBag.Search;
        int? currentCategoryId = ViewBag.CategoryId;
        int? currentYear = ViewBag.Year;
    }

    @if (totalPages > 1)
    {
        <nav aria-label="Movies Pagination" class="d-flex justify-content-center mt-5">
            <ul class="pagination pagination-neon">

                <li class="page-item @(pageNumber <= 1 ? "disabled" : "")">
                    <a class="page-link"
                       href="@Url.Action("Index", new { pageNumber = pageNumber - 1, search = currentSearch, categoryId = currentCategoryId, year = currentYear })"
                       aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>

                @for (int i = 1; i <= totalPages; i++)
                {
                    <li class="page-item @(i == pageNumber ? "active" : "")">
                        <a class="page-link"
                           href="@Url.Action("Index", new { pageNumber = i, search = currentSearch, categoryId = currentCategoryId, year = currentYear })">
                            @i
                        </a>
                    </li>
                }

                <li class="page-item @(pageNumber >= totalPages ? "disabled" : "")">
                    <a class="page-link"
                       href="@Url.Action("Index", new { pageNumber = pageNumber + 1, search = currentSearch, categoryId = currentCategoryId, year = currentYear })"
                       aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    }
</div>

@section Scripts {
    <partial name="_NotificationPartial" />
}

<style>
    /* ----------------------------------------------------- */
    /* I. General Body & Neon Typography */
    /* ----------------------------------------------------- */
    body {
        background-color: #0d0a17 !important; /* خلفية داكنة جداً */
        color: #f0f0f0 !important; /* لون الخط الأساسي فاتح */
        font-family: 'Open Sans', sans-serif;
    }

    .text-neon {
        color: #d175ff; /* اللون الأرجواني للنيون */
        text-shadow: 0 0 5px #d175ff, 0 0 10px #d175ff; /* توهج النص */
        font-weight: 700;
    }

    /* ----------------------------------------------------- */
    /* II. Filter Section Styling (Top Bar) */
    /* ----------------------------------------------------- */

    .filter-box {
        background-color: #1a1625; /* خلفية أغمق قليلاً من الخلفية العامة */
        border: 1px solid #3b3054;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(106, 13, 173, 0.3); /* ظل نيون خفيف */
    }

    /* Common style for Input and Select fields */
    .form-control, .form-select.filter-select {
        background-color: #2b263b;
        border: 1px solid #6a0dad;
        color: #ffffff;
        transition: all 0.3s ease;
        border-radius: 8px;
        padding: 0.5rem 1rem;
        height: 45px;
    }

    /* Arrow color for select dropdown */
    .form-select.filter-select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23d175ff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
    }

        .form-control:focus, .form-select.filter-select:focus {
            background-color: #3f3952;
            border-color: #d175ff;
            box-shadow: 0 0 8px rgba(209, 117, 255, 0.9);
            color: #ffffff;
            outline: none;
        }

        .form-select.filter-select option {
            background-color: #1a1625;
            color: #f0f0f0;
        }

    /* Filter Button Styling */
    .btn-filter-neon {
        background-color: #6a0dad;
        border-color: #6a0dad;
        color: #ffffff;
        font-weight: bold;
        letter-spacing: 1px;
        transition: all 0.3s ease;
        border-radius: 8px;
        padding: 0.5rem 1rem;
    }

        .btn-filter-neon:hover {
            background-color: #9333ea;
            border-color: #9333ea;
            box-shadow: 0 0 15px rgba(209, 117, 255, 0.8);
        }

    /* Alert style for No Movies Found */
    .alert-neon-warning {
        background-color: #3f3952;
        color: #ff6666 !important;
        border-color: #ff6666;
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
    }

    /* ----------------------------------------------------- */
    /* III. Card Styling (Movie Cards) */
    /* ----------------------------------------------------- */

    .card.shadow-lg {
        background-color: #1a1625;
        border: 1px solid #3b3054;
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.4s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }

        .card.shadow-lg:hover {
            border-color: #d175ff;
            box-shadow: 0 0 25px rgba(209,117,255,0.7); /* توهج نيون عند التمرير */
            transform: translateY(-5px);
        }

    .card-img-top {
        border-bottom: 2px solid #3b3054;
        object-fit: cover;
        opacity: 0.85;
        transition: opacity 0.4s ease;
    }

    .card.shadow-lg:hover .card-img-top {
        opacity: 1;
    }

    .badge.bg-primary {
        background-color: #6a0dad !important;
        color: #ffffff !important;
        padding: 6px 10px;
        border-radius: 6px;
        font-weight: 600;
    }

    .card-body {
        padding: 20px;
    }

    .card-title {
        color: #d175ff; /* لون نيون للعناوين */
        font-size: 1.5rem;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .card-text-box {
        height: 75px; /* ارتفاع ثابت لضمان اتساق البطاقات */
    }

    .card-text.text-muted {
        color: white !important; /* لون وصف الفيلم */
        height: 60px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        margin-bottom: 15px;
    }

    .card-body strong {
        color: #f0f0f0;
        font-weight: 600;
    }

    .card-body p {
        font-size: 0.95rem;
        color: #cccccc;
    }

    /* ----------------------------------------------------- */
    /* IV. Button Styling (Details and Book Now) */
    /* ----------------------------------------------------- */

    .card-body .d-flex.mt-auto {
        margin-top: 15px !important;
    }

        .card-body .d-flex.mt-auto a, .card-body .d-flex.mt-auto button {
            flex-basis: 50%; /* ضمان تقسيم الأزرار للمساحة بالتساوي */
        }

    .btn-info { /* زر التفاصيل */
        background-color: #d175ff;
        border-color: #d175ff;
        color: #1a1625 !important;
        font-weight: bold;
        border-radius: 6px;
        padding: 8px 20px;
        transition: all 0.3s ease;
    }

        .btn-info:hover {
            background-color: #e599ff;
            border-color: #e599ff;
            box-shadow: 0 0 10px rgba(209,117,255,0.9);
        }

    .btn-book-neon { /* زر الحجز الجديد */
        background-color: #39ff14; /* Neon Green */
        border-color: #39ff14;
        color: #1a1625 !important;
        font-weight: bold;
        border-radius: 6px;
        padding: 8px 20px;
        transition: all 0.3s ease;
    }

        .btn-book-neon:hover {
            background-color: #66ff66;
            border-color: #66ff66;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.8);
        }

    /* ----------------------------------------------------- */
    /* V. Pagination Styling */
    /* ----------------------------------------------------- */

    .pagination-neon {
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(106, 13, 173, 0.4);
    }

    .page-item .page-link {
        background-color: #1a1625;
        border: 1px solid #3b3054;
        color: #f0f0f0;
        transition: all 0.3s ease;
        padding: 10px 15px;
    }

        /* Hover state */
        .page-item .page-link:hover:not(.active .page-link) {
            background-color: #2b263b;
            border-color: #d175ff;
            color: #d175ff;
            box-shadow: 0 0 10px rgba(209, 117, 255, 0.4);
        }

    /* Active state */
    .page-item.active .page-link {
        background-color: #6a0dad !important;
        border-color: #d175ff !important;
        color: #ffffff !important;
        box-shadow: 0 0 15px rgba(209, 117, 255, 0.8);
        font-weight: bold;
    }

    /* Disabled state */
    .page-item.disabled .page-link {
        background-color: #0d0a17;
        border-color: #1a1625;
        color: #666666;
        pointer-events: none;
    }
</style>